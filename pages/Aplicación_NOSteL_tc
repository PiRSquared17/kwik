== Que es y para que sirve la aplicación de NOSteL== 
Aplicación Web en php destinada al tratamiento de campañas telefónicas por parte de las operadoras. De fácil funcionamiento nos permite controlar y administrar las llamadas de una forma automatizada, como si de una pequeña agenda se tratase. En el lado del administrador permite visualizar el estado de las bases de datos (Campañas), el trabajo realizado por nuestras operadoras, a si como los resultados positivos obtenidos.

Para entrar en la aplicacion simplemete pinche en el siguiente enlace [ http://192.168.1.4/nostel/]


== Estructura de archivos ==

Pequeño organigrama de la estructura de la aplicación

[[Imagen:NosEstructura.png]]

Todas la paginas están incluidas en el index, de la siguiente forma siendo $dir la dirección que le paso por GET en el enlace 

 <body onload="document.body.scroll='yes'">
  <?
   include('bbdd.php');
   include('header.php');
   include $dir;
   include('pie.php');
  ?>
 </body>

Al el área de trabajo del administrador, se accede médiate usuario y contraseña (USER: nostel PASS: 1234) entraremos directamente al estado de las campañas (administrador.php), todas las paginas llevan incluido el menú que a su vez tiene un enlace a cada una de ellas:
* administrador.php (Estado de las campañas).
* llamadas.php (llamadas realizadas por las operadoras).
* positivos.php (resultados positivos de las campañas).
* reofrecer.php (Reofrecer teléfonos negativos o no contestan).


Al área de trabajo de las operadoras se accede eligiendo operadora y campaña, entrando a la pagina principal o de trabajo igual que en la parte de los administradores todas las paginas incluyen el menú que a su vez tienen un enlace cada una de ellas:
* trabajo.php (área de trabajo, acceso a los teléfonos de las campañas)
* agendados.php (pequeña agenda)


==Estructura de la base de datos==
====Estructura de la base de datos====

Estructura de la base de datos de la aplicacion de nostel para las operadoras.

[[Imagen:NosBases.png]]

* campanas, campañas activas
* home, migraciones, pcmecia.. datos de las campañas.* procesados datos de los registros procesados

==== Estructuras de las tablas ====

* '''campanas'''
[[Imagen:Noscampanas.png]]

* '''tablas de las campañas''', estas tablas pueden tener la estructura que se quiera, siendo la única condición que el nombre de los campos coincidan con campos existentes en la tabla de procesados.

* '''procesados'''
[[Imagen:NosProcesados.png]]


==Funcionamiento de la aplicación del lado de las operadoras==

==== Trabajo ====

La aplicacion de nostel tiene un funcionamiento muy simple, se lee un registro de la tabla correspondiente a la campaña seleccionada, y se bloquea
  
  $sql="Select * from $campana where telefono is not null limit 1 for update";

y se guarda en la tabla de procesados

  $sql="INSERT INTO `procesados` VALUES
    (null,
    '$telefono',
    NOW(),
    NOW(),
    '".utf8_decode($_POST['nombre'])."',
    '".utf8_decode($_POST['direccion'])."',
    '".utf8_decode($_POST['cod_postal'])."',
    '".utf8_decode($_POST['localidad'])."',
    '".utf8_decode($_POST['provincia'])."',
    '".utf8_decode($_POST['nif'])."',
    '".utf8_decode($_POST['cbanco'])."' ,
    '".utf8_decode($_POST['terminal'])."' ,
    '".utf8_decode($_POST['tarifa'])."',
    '".utf8_decode($_POST['comentarios'])."' ,
    '$campana',
    '$operadora',
    '".utf8_decode($_POST['resultado'])."' ,
    '$fecha_ag')";

En la tabla correspondiente a la campaña seleccionada, el teléfono con el que hemos trabajado se convierte en null
  $sql="Update $campana set telefono = null where telefono = $telefono";

con todo esto solo es necesario rellenar los datos del formulario y guardar.

Cuando se edita un teléfono a parte de los datos "normales" hay que rellenar otro campo obligatorio el estado, hay 4 estados posibles :
* No contesta: El cliente no contesta
* Positivo: El resultado de la llamada ha sido positivo entonces aparecerán nuevos campos a rellenar como la cuenta del banco, el Terminal y la tarifa.
* Negativo: El resultado de la llamada ha sido negativo
* Agendado: Se agenda la llamada para otro día, al elegir este estado aparece un pequeño calendario para elegir la fecha, (el campo es timestamp a si que la hora se pone por defecto : 12:34:56).

==== Agendados ====

Una de las opciones del menú de las operadoras es el de agendados, se trata de una pequeña agenda para que ellas puedan llevar el control de las llamadas pospuestas para otro dia.

Su funcionamiento es sencillo, al entrar en la pagina nos mostrara médiate la consulta

 $f_agenda= $fecha_agenda.' 12:34:56';
 $consulta = mysql_query("SELECT * FROM `procesados` WHERE operadora='".$_SESSION['operadora']."' AND
              resultado='Agendar' AND fecha_ag LIKE '$f_agenda' ORDER BY fecha_ag DESC", $link);

Nos aparecerá una tabla con los agendados del día de hoy, si deseamos ver los agendados de otro día simplemente elegimos otra fecha en el calendario situado en la parte superior, o pulsamos el botón de mostrar todos, entonces nos mostraran todos los registros agendados.
Todas estas variaciones de las consultas se realizan mediante una llamada a [[AJAX]] en la cual se pasa la fecha para hacer la consulta o % para ver todos.

En una de las casillas de la tabla donde aparecen los datos, hay un botón de editar, al pulsarlo se ara una llamada a ajax pasándole como parámetro el id del registro. Cuando se ejecuta el ajax nos aparece una pantalla similar al formulario del principio, simplemente rellenar y guardar.

Al guardarlo llamamos otra vez mediante ajax a trabajo_guardar.php con la diferencia que mediante una variable de sesión le indicamos que la acción es editar y no guardar.

Y ya esta guardamos el registro con el nuevo resultado, para poder verlo otro dia, registro agendado, o terminar el trabajo.


==Funcionamiento de la aplicación del lado de los administradores ==

La aplicacion de nostel por el lado de los administradores, tiene mas una funcion administrativa, control del estado de las campañas, edición de resultados positivos, reoferta de telefonos, listado de las llamadas, informativo para conocer el trabajo de las operadoras.

====Pagina principal o estado de las campañas ====

Esta pantaña nos da informacion muy importante sobre el estado de las campañas, telefonos ofrecidos, telefonos que restan, cuantos ha sido positivos ect.

== Importación de nuevas campañas ==
Coger una campaña existente y duplicarla. Vaciar los datos. Importar datos con el asistente.